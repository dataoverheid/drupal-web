{% macro resource_download_link(url) %}
  <div>
    <i>Download:</i> <a href="{{ url }}" class="download-link" target="_blank">{{ url }}</a>
  </div>
{% endmacro %}

{% macro resource_copy_link(url) %}
  <div class="copydata" data-decorator="init-copydata"
       data-config='{ "triggerLabel": "{{ 'Copy link'|t }}", "triggerCopiedlabel": "{{ 'Copied'|t }}", "triggerClass": "copydata__trigger" }'>
    <p class="copydata__datafield js-copydata__datafield">
      {{ url }}
    </p>
  </div>
{% endmacro %}

{% macro create_resource(key, resource, alias) %}
  <div class="resource">
    <div class="resource-header">
      <h3>{{ resource.name }}</h3>
      <span class="label label-distribution-type">
             {% if resource.distribution_type %}
               {{ ckan_mapping_get_distribution_type_name(resource.distribution_type) }}
             {% else %}
               {{ alias | replace({ '-': ' '}) | capitalize | t }}
             {% endif %}
        </span>
      <span class="label">{{ ckan_mapping_get_file_format_name(resource.format) }}</span>
      <span class="label label-licence">{{ ckan_mapping_get_license_name(resource.license_id) }}</span>
    </div>

    {% if(alias == 'webservice') %}
      {% if resource.download_url %}
        {# If we have a webservice and the download_url is set we'll need to show
           the download link in a copy link box and the resource link as clickable. #}
        {% for url in resource.download_url %}
          {{ _self.resource_copy_link(url) }}
        {% endfor %}
        {{ _self.resource_download_link(resource.url) }}
      {% else %}
        {# If we have a webservice and no download_url we'll show the link in a copy link box. #}
        {{ _self.resource_copy_link(resource.url) }}
      {% endif %}
    {% else %}
      {# For all other resource types we'll always use clickable links. #}
      {{ _self.resource_download_link(resource.url) }}
      {% if resource.download_url %}
        {% for url in resource.download_url %}
          {{ _self.resource_download_link(url) }}
        {% endfor %}
      {% endif %}
    {% endif %}

    <p>{{ ckan_markdown(resource.description) }}</p>

    {% if resource.previewUrl %}
      <div class="preview-action button button--primary" data-preview-id="{{ key }}" data-preview-url="{{ resource.previewUrl }}">
        {{ 'Preview'|t }}
      </div>
      <div id="preview-{{ key }}" class="details-replacement preview-block hidden" data-preview-url="{{ resource.previewUrl }}" data-drupal-selector="preview-{{ key }}" open="close">
        <div role="button" aria-controls="#preview-' + it.getAttribute('data-preview-id') + '" aria-expanded="false" aria-pressed="false" class="details-replacement-summary preview-summary">{{ 'Preview'|t }}</div>
        <div class="preview-content"></div>
      </div>
    {% endif %}

  </div>
{% endmacro %}

<h2 class="visible-xs">{{ alias|capitalize|replace({'-': ' '})|t }}</h2>

{% for key, resource in resources %}
  {{ _self.create_resource(key, resource, alias) }}
{% endfor %}
